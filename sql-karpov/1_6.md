# Группировка данных
## Задание 1
С помощью оператора GROUP BY посчитайте количество курьеров мужского и женского пола в таблице couriers.

Новую колонку с числом курьеров назовите couriers_count.

Результат отсортируйте по этой колонке по возрастанию.

Поля в результирующей таблице: sex, couriers_count

Решение:

    SELECT
        sex,
        COUNT(DISTINCT courier_id) AS couriers_count
    FROM couriers
    GROUP BY
        sex

## Задание 2
Теперь давайте аналогичным образом выясним, сколько всего было сделано заказов и сколько из них было отменено за всё время работы нашего сервиса.

Задание:

Посчитайте количество созданных и отменённых заказов в таблице user_actions.

Новую колонку с числом заказов назовите orders_count.

Результат отсортируйте по числу заказов по возрастанию.

Поля в результирующей таблице: action, orders_count

Решение:

    SELECT
        action,
        COUNT(order_id) AS orders_count
    FROM user_actions
    GROUP BY
        action
    ORDER BY
        COUNT(order_id)

## Задание 3
Используя группировку и функцию DATE_TRUNC, приведите все даты к началу месяца и посчитайте, сколько заказов было сделано в каждом из них.

Расчёты проведите по таблице orders. Колонку с усечённой датой назовите month, колонку с количеством заказов — orders_count.

Результат отсортируйте по месяцам — по возрастанию.

Поля в результирующей таблице: month, orders_count

Пояснение:

Обратите внимание, что в данной задаче вам необходимо провести группировку по новому расчётному полю.

В этой ситуации важно помнить, что колонки, указанные в SELECT, должны находиться и в GROUP BY (если они не используются в агрегационных функциях). При этом в GROUP BY допускается использование алиаса колонки, указанного в блоке SELECT, т.е. повторно производить вычисления в GROUP BY не обязательно.

Решение:

    SELECT
       DATE_TRUNC('month', creation_time) AS month,
       COUNT(order_id) AS orders_count
    FROM orders
    GROUP BY
        month
    ORDER BY
        month

## Задание 4
А теперь немного усложним нашу группировку: добавим в неё вторую колонку и посчитаем, сколько заказов было сделано и сколько было отменено в каждом месяце.

Используя группировку и функцию DATE_TRUNC, приведите все даты к началу месяца и посчитайте, сколько заказов было сделано и сколько было отменено в каждом из них.

В этот раз расчёты проведите по таблице user_actions. Колонку с усечённой датой назовите month, колонку с количеством заказов — orders_count.

Результат отсортируйте сначала по месяцам — по возрастанию, затем по типу действия — тоже по возрастанию.

Поля в результирующей таблице: month, action, orders_count

Решение:
    
    SELECT
        DATE_TRUNC('month', time) AS month,
        action,
        COUNT(order_id) AS orders_count
    FROM user_actions
    GROUP BY
        action,
        month
    ORDER BY
        month,
        action

## Задание 5
По данным в таблице users посчитайте максимальный порядковый номер месяца среди всех порядковых номеров месяцев рождения пользователей сервиса. С помощью группировки проведите расчёты отдельно в двух группах — для пользователей мужского и женского пола.

Новую колонку с максимальным номером месяца рождения в группах назовите max_month. Преобразуйте значения в новой колонке в формат INTEGER, чтобы порядковый номер был выражен целым числом.

Результат отсортируйте по колонке с полом пользователей.

Поля в результирующей таблице: sex, max_month

Пояснение:

Для получения порядкового номера месяца из даты пригодится функция DATE_PART.

Вспомнить, как работает функция DATE_PART, можно на этом шаге.

Преобразования типов данных мы рассматривали в этом уроке.

Решение:

    SELECT 
        sex,
        MAX(DATE_PART('month', birth_date))::INTEGER AS max_month
    FROM users
    GROUP BY
        sex

## Задание 6
По данным в таблице users посчитайте порядковый номер месяца рождения самого молодого пользователя сервиса. С помощью группировки проведите расчёты отдельно в двух группах — для пользователей мужского и женского пола.

Новую колонку с максимальным номером месяца рождения в группах назовите max_month. Преобразуйте значения в новой колонке в формат INTEGER, чтобы порядковый номер был выражен целым числом.

Результат отсортируйте по колонке с полом пользователей.

Поля в результирующей таблице: sex, max_month

Пояснение:

Для получения порядкового номера месяца из даты пригодится функция DATE_PART.

После того как решите задачу, обратите внимание на полученный результат. Совпадет ли он с результатом предыдущего запроса? Похоже ли это на тот случай, который был описан на предыдущем шаге ?

Решение:

    SELECT 
        sex,
        DATE_PART('month', MAX(birth_date))::INTEGER AS max_month
    FROM users
    GROUP BY
        sex

## Задание 7
Посчитайте максимальный возраст пользователей мужского и женского пола в таблице users. Возраст измерьте числом полных лет.

Новую колонку с возрастом назовите max_age. Преобразуйте значения в новой колонке в формат INTEGER, чтобы возраст был выражен целым числом.

Результат отсортируйте по новой колонке по возрастанию возраста.

Поля в результирующей таблице: sex, max_age

Пояснение:

Для вычисления количества полных лет используйте функцию AGE.

В качестве даты, относительно которой считать возраст пользователей, используйте свою текущую дату.

Чтобы извлечь число полных лет из возраста, можно использовать функцию DATE_PART с аргументом 'year'.

Вспомнить, как работает функция AGE, можно на этом шаге.

Время не стоит на месте, поэтому верный ответ может отличаться от примера в ожидаемом результате. Используйте его как ориентир формата ответа.

Решение:

    SELECT 
        MAX(DATE_PART('year', AGE(current_date, birth_date)))::INTEGER AS max_age,
        sex
    FROM users
    GROUP BY
        sex
    ORDER BY
        max_age

## Задание 8
Разбейте пользователей из таблицы users на группы по возрасту (возраст по-прежнему измеряем числом полных лет) и посчитайте количество пользователей каждого возраста.

Колонку с возрастом назовите age, а колонку с числом пользователей — users_count. Преобразуйте значения в колонке с возрастом в формат INTEGER, чтобы возраст был выражен целым числом.

Результат отсортируйте по колонке с возрастом по возрастанию.

Поля в результирующей таблице: age, users_count

Пояснение:

Число полных лет из возраста рассчитывайте тем же способом, что и в предыдущем задании.

Обратите внимание, что у части пользователей вместо возраста будет пропуск. Эту группу также включите в результат и посчитайте число пользователей в ней.

В данной задаче вам необходимо провести группировку по новому расчётному полю. Помните, что повторно производить вычисления в GROUP BY не обязательно, достаточно взять алиас колонки из SELECT.

Время не стоит на месте, поэтому верный ответ может отличаться от примера в ожидаемом результате. Используйте его как ориентир формата ответа.

Решение:

    SELECT 
        DATE_PART('year', AGE(current_date, birth_date))::INTEGER AS age,
        COUNT(user_id) AS users_count
    FROM users
    GROUP BY
        age
    ORDER BY
        age
